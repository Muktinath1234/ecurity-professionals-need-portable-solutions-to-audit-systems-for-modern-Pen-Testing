#!/bin/bash
# Pentest USB Auto-Setup Script
# Author: Security Researcher
# Purpose: Configure bootable USB with essential Pen-Testing tools

LOGFILE="/var/log/pentest_audit.log"
TOOLS=("wireshark" "nmap" "metasploit-framework" "openvas" "burpsuite")

echo "======================================"
echo "   PenTest USB Auto Setup Script       "
echo "======================================"
sleep 1

# 1. Update system
echo "[*] Updating system..."
apt update && apt upgrade -y

# 2. Install required tools
echo "[*] Installing Pen-Testing Tools..."
for tool in "${TOOLS[@]}"; do
    echo "[+] Installing $tool ..."
    apt install -y "$tool"
done

# 3. Configure OpenVAS (Greenbone Vulnerability Manager)
echo "[*] Setting up OpenVAS..."
gvm-setup
gvm-check-setup

# 4. Create audit logging directory
echo "[*] Setting up audit logging..."
mkdir -p /var/log/pentest_audits
touch "$LOGFILE"

# 5. Example: Auto run audits on boot (logs results)
echo "[*] Creating startup audit script..."
cat << 'EOF' > /usr/local/bin/run_audit.sh
#!/bin/bash
LOGFILE="/var/log/pentest_audits/audit_$(date +%F_%T).log"

echo "========= PenTest USB Auto Audit =========" > "$LOGFILE"
echo "[*] Running nmap quick scan on local network..." >> "$LOGFILE"
nmap -F 192.168.0.0/24 >> "$LOGFILE"

echo "[*] Checking open ports with netstat..." >> "$LOGFILE"
netstat -tulnp >> "$LOGFILE"

echo "[*] Capturing 10 packets with tcpdump..." >> "$LOGFILE"
timeout 5 tcpdump -c 10 >> "$LOGFILE" 2>/dev/null

echo "[+] Audit Completed. Results stored in $LOGFILE"
EOF

chmod +x /usr/local/bin/run_audit.sh

# 6. Add script to run automatically at boot
echo "[*] Adding script to rc.local for auto-execution..."
if ! grep -q "run_audit.sh" /etc/rc.local; then
    sed -i -e '$i /usr/local/bin/run_audit.sh\n' /etc/rc.local
fi

echo "======================================"
echo "[âœ”] Setup Complete!"
echo "Plug this USB into any system, boot it, and audits will auto-run."
echo "Logs saved at: /var/log/pentest_audits/"
echo "======================================"
